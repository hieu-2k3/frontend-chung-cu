<!-- Contracts Management Modal -->
<div id="contracts-modal" class="modal hidden">
    <div class="modal-content glass-panel modal-lg">
        <span class="close-modal" id="close-contracts-modal">&times;</span>
        <div class="modal-header">
            <h2><i class="fa-solid fa-file-contract"></i> Quản Lý Hợp Đồng Thuê</h2>
            <button class="btn-primary" onclick="openCreateContractModal()"
                style="width: auto; padding: 0.6rem 1.5rem;">
                <i class="fa-solid fa-plus"></i> Tạo Hợp Đồng Mới
            </button>
        </div>
        <div class="modal-body">
            <!-- Filter -->
            <div style="margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center;">
                <select id="contract-filter"
                    style="padding: 0.5rem 1rem; border-radius: 0.5rem; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.1);">
                    <option value="all">Tất cả</option>
                    <option value="active">Đang hoạt động</option>
                    <option value="expiring">Sắp hết hạn (30 ngày)</option>
                    <option value="expired">Đã hết hạn</option>
                </select>
                <div id="contract-stats" style="color: var(--text-secondary); font-size: 0.9rem;">
                    <span id="active-contracts-count">0</span> đang hoạt động |
                    <span id="expiring-contracts-count" style="color: #fbbf24;">0</span> sắp hết hạn
                </div>
            </div>

            <!-- Contracts Table -->
            <div class="all-residents-scroll-area">
                <table class="residents-table">
                    <thead>
                        <tr>
                            <th>Phòng</th>
                            <th>Khách thuê</th>
                            <th>SĐT</th>
                            <th>Bắt đầu</th>
                            <th>Kết thúc</th>
                            <th>Tiền cọc</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="contracts-list">
                        <tr>
                            <td colspan="8" style="text-align:center; padding:2rem;">Đang tải...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Contract Modal -->
<div id="create-contract-modal" class="modal hidden">
    <div class="modal-content glass-panel" style="max-width: 650px; max-height: 90vh; overflow-y: auto;">
        <span class="close-modal" id="close-create-contract-modal">&times;</span>
        <div class="modal-header">
            <h2><i class="fa-solid fa-file-signature"></i> <span id="contract-form-title">Tạo Hợp Đồng Mới</span></h2>
        </div>
        <div class="modal-body">
            <form id="contract-form" class="premium-form">
                <input type="hidden" id="contract-id" value="">

                <!-- Room Selection -->
                <div class="form-group">
                    <label>Phòng <span style="color: #ef4444;">*</span></label>
                    <select id="contract-room" required>
                        <option value="">-- Chọn phòng --</option>
                    </select>
                </div>

                <!-- Tenant Info -->
                <h3
                    style="color: var(--accent-blue); font-size: 1.1rem; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <i class="fa-solid fa-user"></i> Thông tin khách thuê
                </h3>

                <div class="form-group">
                    <label>Họ và tên <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="contract-tenant-name" placeholder="Nguyễn Văn A" required>
                </div>

                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Số điện thoại <span style="color: #ef4444;">*</span></label>
                        <input type="tel" id="contract-tenant-phone" placeholder="0912345678" required>
                    </div>
                    <div class="form-group">
                        <label>CMND/CCCD</label>
                        <input type="text" id="contract-tenant-id" placeholder="001234567890">
                    </div>
                </div>

                <!-- Financial Info -->
                <h3
                    style="color: var(--accent-green); font-size: 1.1rem; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <i class="fa-solid fa-money-bill-wave"></i> Thông tin tài chính
                </h3>

                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Tiền thuê/tháng (đ) <span style="color: #ef4444;">*</span></label>
                        <input type="number" id="contract-monthly-rent" placeholder="5000000" required>
                    </div>
                    <div class="form-group">
                        <label>Tiền cọc (đ) <span style="color: #ef4444;">*</span></label>
                        <input type="number" id="contract-deposit" placeholder="10000000" required>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="contract-deposit-paid" style="width: auto;">
                        <span>Đã nhận tiền cọc</span>
                    </label>
                </div>

                <!-- Contract Duration -->
                <h3
                    style="color: var(--accent-amber); font-size: 1.1rem; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <i class="fa-solid fa-calendar-days"></i> Thời hạn hợp đồng
                </h3>

                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Ngày bắt đầu <span style="color: #ef4444;">*</span></label>
                        <input type="date" id="contract-start-date" required>
                    </div>
                    <div class="form-group">
                        <label>Thời hạn (tháng) <span style="color: #ef4444;">*</span></label>
                        <input type="number" id="contract-duration" placeholder="12" min="1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Ngày kết thúc (tự động tính)</label>
                    <input type="date" id="contract-end-date" readonly
                        style="background: rgba(0,0,0,0.3); cursor: not-allowed;">
                </div>

                <!-- Terms -->
                <h3
                    style="color: var(--text-secondary); font-size: 1.1rem; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <i class="fa-solid fa-list-check"></i> Điều khoản đặc biệt
                </h3>

                <div id="contract-terms-list" style="margin-bottom: 1rem;">
                    <!-- Terms will be added here -->
                </div>

                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="text" id="new-term-input" placeholder="Nhập điều khoản mới..." style="flex: 1;">
                    <button type="button" class="btn-primary" onclick="addContractTerm()"
                        style="width: auto; padding: 0.5rem 1rem;">
                        <i class="fa-solid fa-plus"></i> Thêm
                    </button>
                </div>

                <!-- Submit -->
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="btn-secondary" onclick="closeCreateContractModal()" style="flex: 1;">
                        Hủy
                    </button>
                    <button type="submit" class="btn-primary" style="flex: 1;">
                        <i class="fa-solid fa-save"></i> Lưu Hợp Đồng
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Contract Detail Modal -->
<div id="contract-detail-modal" class="modal hidden">
    <div class="modal-content glass-panel" style="max-width: 600px;">
        <span class="close-modal" id="close-contract-detail-modal">&times;</span>
        <div class="modal-header">
            <h2><i class="fa-solid fa-file-lines"></i> Chi Tiết Hợp Đồng</h2>
        </div>
        <div class="modal-body" id="contract-detail-content">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>                            đăng nhập:</span>
                        <div style="font-size: 1.1rem; font-weight: 500; color: white;" id="acc-email-display">
                            user@example.com</div>
                    </div>
                    <div>
                        <span
                            style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-bottom: 0.2rem;">Mật
                            khẩu:</span>
                        <div style="font-size: 1.8rem; font-weight: 700; color: #fbbf24; letter-spacing: 2px;"
                            id="acc-pass-display">123456</div>
                    </div>
                </div>

                <button class="btn-primary" id="btn-close-account-modal" style="width: 100%; justify-content: center;">
                    <i class="fa-solid fa-check"></i> Đã Sao Chép & Đóng
                </button>
            </div>
        </div>

        <!-- Reset Confirmation Modal -->
        <div id="reset-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 500px; text-align: center;">
                <div class="delete-confirm-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                </div>
                <h2 style="color: #ef4444; margin-bottom: 1rem;">Reset Hệ Thống?</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Hành động này sẽ <b>XÓA SẠCH</b> toàn bộ cư dân và tài khoản (ngoại trừ bạn).
                    Dữ liệu đã xóa sẽ không thể khôi phục.
                </p>

                <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                    <p style="font-size: 0.85rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Nhập chữ
                        <b>RESET</b> để xác nhận:
                    </p>
                    <input type="text" id="reset-confirm-input" placeholder="Nhập RESET..."
                        style="text-align: center; font-weight: bold; letter-spacing: 2px; border-color: rgba(239, 68, 68, 0.3);">
                </div>

                <div class="delete-confirm-buttons">
                    <button class="btn-cancel" id="btn-close-reset-modal">Huỷ bỏ</button>
                    <button class="btn-confirm-delete" id="btn-execute-reset" style="background: #ef4444; opacity: 0.5;"
                        disabled>
                        Xác Nhận Xoá Hết
                    </button>
                </div>
            </div>
        </div>
        <!-- Announcement Modal -->
        <div id="announcement-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 500px;">
                <span class="close-modal" id="close-announcement-modal">&times;</span>
                <div class="modal-header">
                    <h2><i class="fa-solid fa-bullhorn"></i> Đăng Thông Báo Mới</h2>
                </div>
                <div class="modal-body">
                    <form id="announcement-form" class="premium-form">
                        <div class="form-scroll-area"
                            style="max-height: 400px; overflow-y: auto; padding-right: 0.5rem;">
                            <div class="form-group">
                                <label><i class="fa-solid fa-heading"></i> Tiêu đề thông báo</label>
                                <input type="text" id="ann-title" placeholder="Ví dụ: Lịch cắt nước ngày mai..."
                                    required>
                            </div>
                            <div class="form-group">
                                <label><i class="fa-solid fa-tag"></i> Loại thông báo</label>
                                <select id="ann-type">
                                    <option value="normal">Thông thường</option>
                                    <option value="urgent">Khẩn cấp / Quan trọng</option>
                                    <option value="event">Sự kiện / Tin vui</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fa-solid fa-align-left"></i> Nội dung chi tiết</label>
                                <textarea id="ann-content" rows="4"
                                    style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.1); font-family: inherit;"
                                    required placeholder="Nhập nội dung thông báo..."></textarea>
                            </div>

                            <div class="form-group">
                                <label><i class="fa-solid fa-paperclip"></i> Đính kèm Ảnh / Video (Tùy chọn)</label>
                                <div
                                    style="background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 0.5rem; border: 1px dashed rgba(255,255,255,0.2);">
                                    <input type="file" id="ann-file" accept="image/*,video/*"
                                        style="border: none; padding: 0.5rem;">
                                    <div id="media-preview"
                                        style="margin-top: 0.5rem; display: none; text-align: center;">
                                        <!-- Preview will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-actions" style="margin-top: 1.5rem;">
                            <button type="submit" class="btn-primary w-100">
                                <i class="fa-solid fa-paper-plane"></i> Đăng Thông Báo
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Maintenance Modal -->
        <div id="maintenance-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 600px;">
                <span class="close-modal" id="close-maintenance-modal">&times;</span>
                <div class="modal-header">
                    <h2><i class="fa-solid fa-wrench"></i> Gửi Yêu Cầu / Phản Hồi</h2>
                </div>
                <div class="modal-body">
                    <form id="maintenance-form" class="premium-form">
                        <div class="form-group">
                            <label><i class="fa-solid fa-door-open"></i> Chọn Phòng</label>
                            <select id="maint-room-id" required></select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fa-solid fa-list"></i> Loại yêu cầu</label>
                                <select id="maint-type">
                                    <option value="maintenance">Sửa chữa / Bảo trì</option>
                                    <option value="feedback">Góp ý / Khiếu nại</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fa-solid fa-triangle-exclamation"></i> Ưu tiên</label>
                                <select id="maint-priority">
                                    <option value="low">Thấp</option>
                                    <option value="medium" selected>Trung bình</option>
                                    <option value="high">Khẩn cấp</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><i class="fa-solid fa-heading"></i> Tiêu đề</label>
                            <input type="text" id="maint-title" placeholder="Ví dụ: Hỏng bóng đèn phòng khách" required>
                        </div>
                        <div class="form-group">
                            <label><i class="fa-solid fa-comment-dots"></i> Nội dung chi tiết</label>
                            <textarea id="maint-description" rows="4"
                                style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.1); font-family: inherit;"
                                placeholder="Mô tả chi tiết tình trạng hoặc vấn đề..." required></textarea>
                        </div>
                        <div class="form-actions" style="margin-top: 1.5rem;">
                            <button type="submit" class="btn-primary w-100">
                                <i class="fa-solid fa-paper-plane"></i> Gửi Yêu Cầu
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Maintenance Detail Modal -->
        <div id="maint-detail-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <span class="close-modal" id="close-maint-detail">&times;</span>
                <div class="modal-header">
                    <h2><i class="fa-solid fa-circle-info"></i> Chi tiết Yêu cầu</h2>
                </div>
                <div class="modal-body" id="maint-detail-body">
                    <!-- Content injected via JS -->
                </div>
            </div>
        </div>

        <!-- Announcement Detail Modal -->
        <div id="ann-detail-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <span class="close-modal" id="close-ann-detail">&times;</span>
                <div class="modal-header">
                    <h2 id="ann-detail-title-head">Chi tiết Thông báo</h2>
                </div>
                <div class="modal-body" id="ann-detail-body">
                    <!-- Content injected via JS -->
                </div>
            </div>
        </div>

        <!-- Market Detail Modal -->
        <div id="mkt-detail-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <span class="close-modal" id="close-mkt-detail">&times;</span>
                <div class="modal-header">
                    <h2>Chi tiết Rau củ / Đồ dùng</h2>
                </div>
                <div class="modal-body" id="mkt-detail-body">
                    <!-- Content injected via JS -->
                </div>
            </div>
        </div>
    </div> <!-- end app-container -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>

</html>
```